# 深入解析ncnn::Net类——高效部署神经网络的核心组件

最近在学习ncnn推理框架，下面整理了ncnn::Net 的使用方法。

在移动端和嵌入式设备上进行高效的神经网络推理，要求框架具备轻量化、高性能以及灵活的扩展能力。作为腾讯开源的高性能神经网络推理框架，ncnn在这些方面表现出色。而在ncnn的核心组件中，`ncnn::Net`类扮演了至关重要的角色。本文将详细介绍`ncnn::Net`类的结构、功能及其使用方法，帮助开发者更好地理解和利用这一强大的工具。



### 1. Net类简介

`ncnn::Net`类是ncnn框架中用于管理和执行神经网络的主要接口。它负责加载网络结构和权重、配置推理选项、管理层与Blob等关键资源，并提供了与外部数据交互的接口。通过`Net`类，开发者可以方便地加载预训练模型、进行前向推理并获取结果，适用于多种应用场景，如图像分类、目标检测和语义分割等。

<details data-line="27" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;"><span class="hljs-keyword" style="color: rgb(198, 120, 221);">namespace</span> ncnn {

<span class="hljs-keyword" style="color: rgb(198, 120, 221);">class</span> <span class="hljs-title class_" style="color: rgb(230, 192, 123);">NCNN_EXPORT</span> Net
{
<span class="hljs-keyword" style="color: rgb(198, 120, 221);">public</span>:
    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 构造函数</span>
    <span class="hljs-built_in" style="color: rgb(230, 192, 123);">Net</span>();
    
    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 析构函数</span>
    <span class="hljs-keyword" style="color: rgb(198, 120, 221);">virtual</span> ~<span class="hljs-built_in" style="color: rgb(230, 192, 123);">Net</span>();

<span class="hljs-keyword" style="color: rgb(198, 120, 221);">public</span>:
    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 配置选项</span>
    Option opt;

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// Vulkan相关设置</span>
    <span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> NCNN_VULKAN</span>
        <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">void</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">set_vulkan_device</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> device_index)</span></span>;
        <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">void</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">set_vulkan_device</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> VulkanDevice* vkdev)</span></span>;
        <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> VulkanDevice* <span class="hljs-title" style="color: rgb(97, 174, 238);">vulkan_device</span><span class="hljs-params">()</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">const</span></span>;
    <span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">endif</span> <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// NCNN_VULKAN</span></span>

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 自定义层注册</span>
    <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">register_custom_layer</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">char</span>* type, layer_creator_func creator, layer_destroyer_func destroyer = <span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>, <span class="hljs-type" style="color: rgb(209, 154, 102);">void</span>* userdata = <span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword" style="color: rgb(198, 120, 221);">virtual</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">custom_layer_to_index</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">char</span>* type)</span></span>;
    <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">register_custom_layer</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> index, layer_creator_func creator, layer_destroyer_func destroyer = <span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>, <span class="hljs-type" style="color: rgb(209, 154, 102);">void</span>* userdata = <span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>)</span></span>;
    
    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 加载参数与模型</span>
    <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">load_param_bin</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> DataReader&amp; dr)</span></span>;
    <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">load_model</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> DataReader&amp; dr)</span></span>;
    
    <span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> NCNN_STDIO</span>
        <span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> NCNN_STRING</span>
            <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">load_param</span><span class="hljs-params">(FILE* fp)</span></span>;
            <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">load_param</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">char</span>* protopath)</span></span>;
            <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">load_param_mem</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">char</span>* mem)</span></span>;
        <span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">endif</span> <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// NCNN_STRING</span></span>
        <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">load_param_bin</span><span class="hljs-params">(FILE* fp)</span></span>;
        <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">load_param_bin</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">char</span>* protopath)</span></span>;
        <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">load_model</span><span class="hljs-params">(FILE* fp)</span></span>;
        <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">load_model</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">char</span>* modelpath)</span></span>;
    <span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">endif</span> <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// NCNN_STDIO</span></span>

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 清除网络</span>
    <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">void</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">clear</span><span class="hljs-params">()</span></span>;

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 创建提取器</span>
    <span class="hljs-function">Extractor <span class="hljs-title" style="color: rgb(97, 174, 238);">create_extractor</span><span class="hljs-params">()</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">const</span></span>;

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 获取输入输出信息</span>
    <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> std::vector&lt;<span class="hljs-type" style="color: rgb(209, 154, 102);">int</span>&gt;&amp; <span class="hljs-title" style="color: rgb(97, 174, 238);">input_indexes</span><span class="hljs-params">()</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">const</span></span>;
    <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> std::vector&lt;<span class="hljs-type" style="color: rgb(209, 154, 102);">int</span>&gt;&amp; <span class="hljs-title" style="color: rgb(97, 174, 238);">output_indexes</span><span class="hljs-params">()</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">const</span></span>;
    <span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> NCNN_STRING</span>
        <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> std::vector&lt;<span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">char</span>*&gt;&amp; <span class="hljs-title" style="color: rgb(97, 174, 238);">input_names</span><span class="hljs-params">()</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">const</span></span>;
        <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> std::vector&lt;<span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">char</span>*&gt;&amp; <span class="hljs-title" style="color: rgb(97, 174, 238);">output_names</span><span class="hljs-params">()</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">const</span></span>;
    <span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">endif</span></span>
    <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> std::vector&lt;Blob&gt;&amp; <span class="hljs-title" style="color: rgb(97, 174, 238);">blobs</span><span class="hljs-params">()</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">const</span></span>;
    <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> std::vector&lt;Layer*&gt;&amp; <span class="hljs-title" style="color: rgb(97, 174, 238);">layers</span><span class="hljs-params">()</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">const</span></span>;
    <span class="hljs-function">std::vector&lt;Blob&gt;&amp; <span class="hljs-title" style="color: rgb(97, 174, 238);">mutable_blobs</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function">std::vector&lt;Layer*&gt;&amp; <span class="hljs-title" style="color: rgb(97, 174, 238);">mutable_layers</span><span class="hljs-params">()</span></span>;

<span class="hljs-keyword" style="color: rgb(198, 120, 221);">protected</span>:
    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 自定义层创建</span>
    <span class="hljs-function"><span class="hljs-keyword" style="color: rgb(198, 120, 221);">virtual</span> Layer* <span class="hljs-title" style="color: rgb(97, 174, 238);">create_custom_layer</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> index)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword" style="color: rgb(198, 120, 221);">virtual</span> Layer* <span class="hljs-title" style="color: rgb(97, 174, 238);">create_overwrite_builtin_layer</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> typeindex)</span></span>;

<span class="hljs-keyword" style="color: rgb(198, 120, 221);">private</span>:
    <span class="hljs-built_in" style="color: rgb(230, 192, 123);">Net</span>(<span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> Net&amp;);
    Net&amp; <span class="hljs-keyword" style="color: rgb(198, 120, 221);">operator</span>=(<span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> Net&amp;);

<span class="hljs-keyword" style="color: rgb(198, 120, 221);">private</span>:
    NetPrivate* <span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> d;
};

} <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// namespace ncnn</span></span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

### 2. 构造与析构

`Net`类提供了默认构造函数和析构函数，用于初始化和销毁网络对象。在构造函数中，网络的内部资源会被初始化，而析构函数则负责释放所有分配的资源，确保没有内存泄漏。

<details data-line="109" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;">ncnn::Net net; <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 创建Net对象</span>
<span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 使用net进行操作</span>

<span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// Net对象在作用域结束时自动析构</span></span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

### 3. Option选项配置

`Net`类中的`Option`成员用于配置网络的各种参数，如线程数、内存分配器、是否启用Vulkan计算等。这些选项可以在加载网络结构和权重之前进行设置，以优化推理性能和资源使用。

#### Option类概述

`Option`类定义在`option.h`文件中，包含了多个可配置选项，如下所示：

<details data-line="124" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;"><span class="hljs-keyword" style="color: rgb(198, 120, 221);">namespace</span> ncnn {

<span class="hljs-keyword" style="color: rgb(198, 120, 221);">class</span> <span class="hljs-title class_" style="color: rgb(230, 192, 123);">Allocator</span>;
<span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> NCNN_VULKAN</span>
<span class="hljs-keyword" style="color: rgb(198, 120, 221);">class</span> <span class="hljs-title class_" style="color: rgb(230, 192, 123);">VkAllocator</span>;
<span class="hljs-keyword" style="color: rgb(198, 120, 221);">class</span> <span class="hljs-title class_" style="color: rgb(230, 192, 123);">PipelineCache</span>;
<span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">endif</span> <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// NCNN_VULKAN</span></span>

<span class="hljs-keyword" style="color: rgb(198, 120, 221);">class</span> <span class="hljs-title class_" style="color: rgb(230, 192, 123);">NCNN_EXPORT</span> Option
{
<span class="hljs-keyword" style="color: rgb(198, 120, 221);">public</span>:
    <span class="hljs-built_in" style="color: rgb(230, 192, 123);">Option</span>();

<span class="hljs-keyword" style="color: rgb(198, 120, 221);">public</span>:
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> lightmode;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> num_threads;
    Allocator* blob_allocator;
    Allocator* workspace_allocator;

<span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> NCNN_VULKAN</span>
    VkAllocator* blob_vkallocator;
    VkAllocator* workspace_vkallocator;
    VkAllocator* staging_vkallocator;
    PipelineCache* pipeline_cache;
<span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">endif</span> <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// NCNN_VULKAN</span></span>

    <span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> openmp_blocktime;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_winograd_convolution;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_sgemm_convolution;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_int8_inference;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_vulkan_compute;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_bf16_storage;

    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_fp16_packed;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_fp16_storage;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_fp16_arithmetic;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_int8_packed;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_int8_storage;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_int8_arithmetic;

    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_packing_layout;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_shader_pack8;

    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_subgroup_basic;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_subgroup_vote;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_subgroup_ballot;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_subgroup_shuffle;

    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_image_storage;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_tensor_storage;

    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_reserved_0;

    <span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> flush_denormals;

    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_local_pool_allocator;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_shader_local_memory;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_cooperative_matrix;

    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_winograd23_convolution;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_winograd43_convolution;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_winograd63_convolution;

    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_a53_a55_optimized_kernel;

    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_reserved_7;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_reserved_8;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_reserved_9;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_reserved_10;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">bool</span> use_reserved_11;
};

} <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// namespace ncnn</span></span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

#### 配置选项示例

<details data-line="202" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;">ncnn::Net net;
ncnn::Option opt;

<span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 启用轻量模式</span>
opt.lightmode = <span class="hljs-literal" style="color: rgb(86, 182, 194);">true</span>;

<span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 设置线程数为4</span>
opt.num_threads = <span class="hljs-number" style="color: rgb(209, 154, 102);">4</span>;

<span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 启用Vulkan计算</span>
opt.use_vulkan_compute = <span class="hljs-literal" style="color: rgb(86, 182, 194);">true</span>;

<span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 使用自定义内存分配器</span>
CustomAllocator alloc;
opt.blob_allocator = &amp;alloc;
opt.workspace_allocator = &amp;alloc;

<span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 将配置应用到网络</span>
net.opt = opt;</span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

### 4. 自定义层注册

ncnn框架允许开发者注册自定义层，以扩展框架的功能或实现特定的操作。`register_custom_layer`函数用于注册自定义层，支持通过层类型名称或索引进行注册。

#### 通过层类型名称注册

<details data-line="230" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;"><span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> NCNN_STRING</span>
    <span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">register_custom_layer</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">char</span>* type, layer_creator_func creator, layer_destroyer_func destroyer = <span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>, <span class="hljs-type" style="color: rgb(209, 154, 102);">void</span>* userdata = <span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword" style="color: rgb(198, 120, 221);">virtual</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">custom_layer_to_index</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">char</span>* type)</span></span>;
<span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">endif</span> <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// NCNN_STRING</span></span></span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

#### 通过层索引注册

<details data-line="239" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;"><span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">register_custom_layer</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> index, layer_creator_func creator, layer_destroyer_func destroyer = <span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>, <span class="hljs-type" style="color: rgb(209, 154, 102);">void</span>* userdata = <span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>)</span></span>;</span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

#### 使用示例

假设我们有一个自定义层`MyCustomLayer`，其创建和销毁函数分别为`create_my_custom_layer`和`destroy_my_custom_layer`。

<details data-line="247" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;"><span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 定义创建函数</span>
<span class="hljs-function">Layer* <span class="hljs-title" style="color: rgb(97, 174, 238);">create_my_custom_layer</span><span class="hljs-params">()</span></span>;
<span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">void</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">destroy_my_custom_layer</span><span class="hljs-params">(Layer* layer)</span></span>;

ncnn::Net net;

<span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 通过层类型名称注册</span>
net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">register_custom_layer</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"MyCustomLayer"</span>, create_my_custom_layer, destroy_my_custom_layer);

<span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 或者通过层索引注册（假设MyCustomLayer的索引为100）</span>
net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">register_custom_layer</span>(<span class="hljs-number" style="color: rgb(209, 154, 102);">100</span>, create_my_custom_layer, destroy_my_custom_layer);</span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

### 5. 加载网络参数与模型

`Net`类提供了多种加载网络参数和模型文件的方法，支持从文件系统和内存中加载网络结构（参数）和权重（模型）。以下将详细介绍这些方法。

#### 加载参数

参数文件定义了网络的结构，包括各层的类型、序列及其连接关系。参数文件可以是文本格式（param）或二进制格式（param.bin）。

<details data-line="269" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;"><span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 加载二进制参数文件</span>
<span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> ret = net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">load_param_bin</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"model.param.bin"</span>);
<span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> (ret != <span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>) {
    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 处理错误</span>
}

<span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 加载内存中的参数数据</span>
<span class="hljs-type" style="color: rgb(209, 154, 102);">unsigned</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">char</span>* param_mem = ...; <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 参数数据内存指针</span>
<span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> consumed = net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">load_param</span>(param_mem);</span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

#### 加载模型

模型文件包含了网络的权重数据。模型文件通常为二进制格式（model.bin），也可以从内存中加载。

<details data-line="285" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;"><span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 加载二进制模型文件</span>
<span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> ret = net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">load_model</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"model.bin"</span>);
<span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> (ret != <span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>) {
    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 处理错误</span>
}

<span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 加载内存中的模型数据</span>
<span class="hljs-type" style="color: rgb(209, 154, 102);">unsigned</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">char</span>* model_mem = ...; <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 模型数据内存指针</span>
<span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> consumed = net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">load_model</span>(model_mem);</span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

#### 从文件加载参数与模型

<details data-line="299" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;"><span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> NCNN_STDIO</span>
    <span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> NCNN_STRING</span>
        <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 从文件路径加载参数</span>
        <span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> ret = net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">load_param</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"model.param"</span>);
    <span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">endif</span> <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// NCNN_STRING</span></span>
    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 从文件路径加载二进制参数</span>
    <span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> ret = net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">load_param_bin</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"model.param.bin"</span>);

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 从文件路径加载模型</span>
    ret = net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">load_model</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"model.bin"</span>);
<span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">endif</span> <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// NCNN_STDIO</span></span></span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

#### 从Android Asset加载（仅适用于Android平台）

<details data-line="315" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;"><span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> NCNN_PLATFORM_API &amp;&amp; __ANDROID_API__ &gt;= 9</span>
    <span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> NCNN_STRING</span>
        <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 从Android Asset加载参数文件</span>
        net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">load_param</span>(asset);
        net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">load_param</span>(asset_mgr, <span class="hljs-string" style="color: rgb(152, 195, 121);">"path/to/model.param"</span>);

        <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 从Android Asset加载二进制参数文件</span>
        net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">load_param_bin</span>(asset);
        net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">load_param_bin</span>(asset_mgr, <span class="hljs-string" style="color: rgb(152, 195, 121);">"path/to/model.param.bin"</span>);
    <span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">endif</span> <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// NCNN_STRING</span></span>
    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 从Android Asset加载模型文件</span>
    net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">load_model</span>(asset);
    net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">load_model</span>(asset_mgr, <span class="hljs-string" style="color: rgb(152, 195, 121);">"path/to/model.bin"</span>);
<span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">endif</span> <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// NCNN_PLATFORM_API</span></span></span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

### 6. 输入与输出管理

`ncnn::Net`类通过Blob索引和名称管理输入和输出。开发者可以通过索引或名称设置输入数据，并提取推理结果。

#### 获取输入输出索引与名称

<details data-line="338" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;"><span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> std::vector&lt;<span class="hljs-type" style="color: rgb(209, 154, 102);">int</span>&gt;&amp; input_indexes = net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">input_indexes</span>();
<span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> std::vector&lt;<span class="hljs-type" style="color: rgb(209, 154, 102);">int</span>&gt;&amp; output_indexes = net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">output_indexes</span>();

<span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> NCNN_STRING</span>
    <span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> std::vector&lt;<span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">char</span>*&gt;&amp; input_names = net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">input_names</span>();
    <span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> std::vector&lt;<span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">char</span>*&gt;&amp; output_names = net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">output_names</span>();
<span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">endif</span></span></span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

#### 通过索引设置输入和提取输出

<details data-line="350" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;">ncnn::Extractor ex = net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">create_extractor</span>();

<span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 设置输入</span>
ex.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">input</span>(<span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>, input_mat); <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 通过Blob索引设置</span>

<span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 提取输出</span>
ncnn::Mat output_mat;
ex.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">extract</span>(<span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>, output_mat); <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 通过Blob索引提取</span></span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

#### 通过名称设置输入和提取输出（需要开启NCNN_STRING）

<details data-line="363" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;"><span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> NCNN_STRING</span>
    ncnn::Extractor ex = net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">create_extractor</span>();

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 设置输入</span>
    ex.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">input</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"input_blob_name"</span>, input_mat); <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 通过Blob名称设置</span>

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 提取输出</span>
    ncnn::Mat output_mat;
    ex.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">extract</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"output_blob_name"</span>, output_mat); <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 通过Blob名称提取</span>
<span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">endif</span></span></span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

### 7. 创建Extractor

`Extractor`类是用于执行前向推理的实例，通过`Net`类创建。`Extractor`支持多线程、内存分配器设置以及Vulkan加速等配置。

#### 创建Extractor

<details data-line="382" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;">ncnn::Extractor ex = net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">create_extractor</span>();</span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

#### 配置Extractor选项

<details data-line="388" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;">ex.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">set_light_mode</span>(<span class="hljs-literal" style="color: rgb(86, 182, 194);">true</span>); <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 启用轻量模式，回收中间Blob</span>
ex.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">set_num_threads</span>(<span class="hljs-number" style="color: rgb(209, 154, 102);">4</span>); <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 设置Extractor的线程数</span>

<span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 设置自定义内存分配器</span>
CustomAllocator alloc;
ex.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">set_blob_allocator</span>(&amp;alloc);
ex.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">set_workspace_allocator</span>(&amp;alloc);</span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

### 8. Vulkan支持

ncnn支持基于Vulkan的GPU加速，通过`VkAllocator`和相关配置，可以在支持Vulkan的设备上利用GPU进行高效推理。

#### 设置Vulkan设备

<details data-line="404" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;"><span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> NCNN_VULKAN</span>
    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 通过设备索引设置Vulkan设备</span>
    net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">set_vulkan_device</span>(<span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>); <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 使用第一个Vulkan设备</span>

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 或者通过VulkanDevice句柄设置</span>
    <span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> VulkanDevice* vkdev = ...;
    net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">set_vulkan_device</span>(vkdev);
<span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">endif</span> <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// NCNN_VULKAN</span></span></span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

#### 设置Extractor的Vulkan选项

<details data-line="417" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;"><span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> NCNN_VULKAN</span>
    ncnn::Extractor ex = net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">create_extractor</span>();
    ex.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">set_vulkan_compute</span>(<span class="hljs-literal" style="color: rgb(86, 182, 194);">true</span>); <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 启用Vulkan计算</span>

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 设置Vulkan内存分配器</span>
    VkAllocator vkalloc;
    ex.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">set_blob_vkallocator</span>(&amp;vkalloc);
    ex.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">set_workspace_vkallocator</span>(&amp;vkalloc);
    ex.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">set_staging_vkallocator</span>(&amp;vkalloc);
<span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">endif</span> <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// NCNN_VULKAN</span></span></span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

### 9. 内存管理与优化

ncnn通过引用计数、自定义内存分配器和内存池复用等机制，实现高效的内存管理。同时，`Option`和`Extractor`类提供了多种配置选项，帮助开发者根据需求优化内存使用和推理性能。

#### 自定义内存分配器

开发者可以实现自定义的`Allocator`，以满足特定的内存管理需求或优化策略。

<details data-line="438" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;"><span class="hljs-keyword" style="color: rgb(198, 120, 221);">class</span> <span class="hljs-title class_" style="color: rgb(230, 192, 123);">CustomAllocator</span> : <span class="hljs-keyword" style="color: rgb(198, 120, 221);">public</span> ncnn::Allocator 
{
<span class="hljs-keyword" style="color: rgb(198, 120, 221);">public</span>:
    <span class="hljs-function"><span class="hljs-keyword" style="color: rgb(198, 120, 221);">virtual</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">void</span>* <span class="hljs-title" style="color: rgb(97, 174, 238);">fastMalloc</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">size_t</span> size)</span> <span class="hljs-keyword" style="color: rgb(198, 120, 221);">override</span> </span>{
        <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 自定义内存分配逻辑</span>
        <span class="hljs-keyword" style="color: rgb(198, 120, 221);">return</span> <span class="hljs-built_in" style="color: rgb(230, 192, 123);">malloc</span>(size);
    }

    <span class="hljs-function"><span class="hljs-keyword" style="color: rgb(198, 120, 221);">virtual</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">void</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">fastFree</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">void</span>* ptr)</span> <span class="hljs-keyword" style="color: rgb(198, 120, 221);">override</span> </span>{
        <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 自定义内存释放逻辑</span>
        <span class="hljs-built_in" style="color: rgb(230, 192, 123);">free</span>(ptr);
    }
};

CustomAllocator alloc;
ncnn::Option opt;
opt.blob_allocator = &amp;alloc;
opt.workspace_allocator = &amp;alloc;
net.opt = opt;</span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

#### 内存池复用与对齐

通过内存池复用和自动内存对齐，ncnn提高了内存利用率和数据访问效率，减少了内存分配和释放的开销。

<details data-line="464" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;"><span class="hljs-keyword" style="color: rgb(198, 120, 221);">class</span> <span class="hljs-title class_" style="color: rgb(230, 192, 123);">PoolAllocator</span> : <span class="hljs-keyword" style="color: rgb(198, 120, 221);">public</span> ncnn::Allocator 
{
    std::vector&lt;std::pair&lt;<span class="hljs-type" style="color: rgb(209, 154, 102);">size_t</span>, <span class="hljs-type" style="color: rgb(209, 154, 102);">void</span>*&gt;&gt; freed_memory;
<span class="hljs-keyword" style="color: rgb(198, 120, 221);">public</span>:
    <span class="hljs-function"><span class="hljs-keyword" style="color: rgb(198, 120, 221);">virtual</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">void</span>* <span class="hljs-title" style="color: rgb(97, 174, 238);">fastMalloc</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">size_t</span> size)</span> <span class="hljs-keyword" style="color: rgb(198, 120, 221);">override</span> </span>{
        <span class="hljs-keyword" style="color: rgb(198, 120, 221);">for</span> (<span class="hljs-keyword" style="color: rgb(198, 120, 221);">auto</span> it = freed_memory.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">begin</span>(); it != freed_memory.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">end</span>(); ++it) {
            <span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> (it-&gt;first &gt;= size) {
                <span class="hljs-type" style="color: rgb(209, 154, 102);">void</span>* ptr = it-&gt;second;
                freed_memory.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">erase</span>(it);
                <span class="hljs-keyword" style="color: rgb(198, 120, 221);">return</span> ptr;
            }
        }
        <span class="hljs-keyword" style="color: rgb(198, 120, 221);">return</span> <span class="hljs-built_in" style="color: rgb(230, 192, 123);">malloc</span>(size);
    }

    <span class="hljs-function"><span class="hljs-keyword" style="color: rgb(198, 120, 221);">virtual</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">void</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">fastFree</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">void</span>* ptr)</span> <span class="hljs-keyword" style="color: rgb(198, 120, 221);">override</span> </span>{
        <span class="hljs-type" style="color: rgb(209, 154, 102);">size_t</span> size = <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">/* 获取ptr对应的大小 */</span>;
        freed_memory.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">emplace_back</span>(size, ptr);
    }
};

PoolAllocator pool_alloc;
ncnn::Option opt;
opt.blob_allocator = &amp;pool_alloc;
opt.workspace_allocator = &amp;pool_alloc;
net.opt = opt;</span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

### 10. 实例代码

以下是一个完整的示例，展示如何使用`ncnn::Net`类加载模型、设置Option、创建Extractor并进行推理。

<details data-line="497" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;"><span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">include</span> <span class="hljs-string" style="color: rgb(152, 195, 121);">"net.h"</span></span>
<span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">include</span> <span class="hljs-string" style="color: rgb(152, 195, 121);">"mat.h"</span></span>
<span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">include</span> <span class="hljs-string" style="color: rgb(152, 195, 121);">&lt;stdio.h&gt;</span></span>

<span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 创建Net对象</span>
    ncnn::Net net;

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 配置选项</span>
    ncnn::Option opt;
    opt.lightmode = <span class="hljs-literal" style="color: rgb(86, 182, 194);">true</span>;
    opt.num_threads = <span class="hljs-number" style="color: rgb(209, 154, 102);">4</span>;
    opt.use_winograd_convolution = <span class="hljs-literal" style="color: rgb(86, 182, 194);">true</span>;
    opt.use_sgemm_convolution = <span class="hljs-literal" style="color: rgb(86, 182, 194);">true</span>;
    opt.use_int8_inference = <span class="hljs-literal" style="color: rgb(86, 182, 194);">true</span>;
    opt.use_packing_layout = <span class="hljs-literal" style="color: rgb(86, 182, 194);">true</span>;
    net.opt = opt;

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 加载参数和模型</span>
    <span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> (net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">load_param</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"model.param"</span>) != <span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>) {
        <span class="hljs-built_in" style="color: rgb(230, 192, 123);">printf</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"Failed to load param file\n"</span>);
        <span class="hljs-keyword" style="color: rgb(198, 120, 221);">return</span> <span class="hljs-number" style="color: rgb(209, 154, 102);">-1</span>;
    }
    <span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> (net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">load_model</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"model.bin"</span>) != <span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>) {
        <span class="hljs-built_in" style="color: rgb(230, 192, 123);">printf</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"Failed to load model file\n"</span>);
        <span class="hljs-keyword" style="color: rgb(198, 120, 221);">return</span> <span class="hljs-number" style="color: rgb(209, 154, 102);">-1</span>;
    }

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 创建Extractor</span>
    ncnn::Extractor ex = net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">create_extractor</span>();
    ex.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">set_num_threads</span>(<span class="hljs-number" style="color: rgb(209, 154, 102);">4</span>);
    ex.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">set_light_mode</span>(<span class="hljs-literal" style="color: rgb(86, 182, 194);">true</span>);

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 准备输入数据</span>
    ncnn::Mat in = ncnn::Mat::<span class="hljs-built_in" style="color: rgb(230, 192, 123);">from_pixels_resize</span>(image_data, ncnn::Mat::PIXEL_RGB, width, height, <span class="hljs-number" style="color: rgb(209, 154, 102);">224</span>, <span class="hljs-number" style="color: rgb(209, 154, 102);">224</span>);
    in.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">substract_mean_normalize</span>(mean_vals, norm_vals);

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 设置输入</span>
    ex.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">input</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"input_blob"</span>, in);

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 提取输出</span>
    ncnn::Mat out;
    ex.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">extract</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"output_blob"</span>, out);

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 处理输出</span>
    <span class="hljs-type" style="color: rgb(209, 154, 102);">float</span>* ptr = out;
    <span class="hljs-keyword" style="color: rgb(198, 120, 221);">for</span> (<span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> i = <span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>; i &lt; out.w; i++) {
        <span class="hljs-built_in" style="color: rgb(230, 192, 123);">printf</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"Class %d: %f\n"</span>, i, ptr[i]);
    }

    <span class="hljs-keyword" style="color: rgb(198, 120, 221);">return</span> <span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>;
}</span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

### 11. 使用示例

下面是一个更具体的示例，展示如何加载一个预训练的图像分类模型，并对一张图片进行推理。

<details data-line="556" class="md-editor-code" open="" style="color: rgb(169, 183, 198); font-size: 12px; line-height: 1; margin: 20px 0px;"><summary class="md-editor-code-head" style="background-color: rgb(40, 44, 52); border-radius: 5px 5px 0px 0px; display: grid; font-size: 12px; grid-template: &quot;1rf 1rf&quot;; height: 32px; justify-content: space-between; margin-bottom: 0px; width: 586.615px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); list-style: none; cursor: pointer;"><div class="md-editor-code-flag" style="margin-left: 12px;"><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; background-color: rgb(236, 106, 94);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(244, 191, 79);"></span><span style="border-radius: 50%; display: inline-block; height: 10px; margin-top: 11px; width: 10px; margin-left: 4px; background-color: rgb(97, 197, 84);"></span></div><div class="md-editor-code-action" style="align-items: center; display: flex;"><span class="md-editor-code-lang" style="margin-right: 10px; line-height: 32px;">cpp</span><span class="md-editor-copy-button" data-tips="复制代码" style="margin-right: 10px; cursor: pointer; line-height: 32px; position: static;">复制代码</span><span class="md-editor-collapse-tips" style="margin-right: 12px;"><svg class="md-editor-icon" aria-hidden="true"><use xlink:href="#md-editor-icon-collapse-tips"></use></svg></span></div></summary><pre style="margin: 0px; position: relative;"><code class="language-cpp" language="cpp" style="background-color: rgb(40, 44, 52); border-radius: 0px 0px 5px 5px; color: rgb(169, 183, 198); line-height: 1.6; padding: 1em; display: block; font-family: source-code-pro, Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14px; overflow: auto; position: relative; box-shadow: rgba(0, 0, 0, 0.333) 0px 2px 2px;"><span class="md-editor-code-block" style="color: rgb(169, 183, 198); display: inline-block; overflow: auto; vertical-align: bottom; width: 523.615px;"><span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">include</span> <span class="hljs-string" style="color: rgb(152, 195, 121);">"net.h"</span></span>
<span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">include</span> <span class="hljs-string" style="color: rgb(152, 195, 121);">"mat.h"</span></span>
<span class="hljs-meta" style="color: rgb(97, 174, 238);">#<span class="hljs-keyword" style="color: rgb(198, 120, 221);">include</span> <span class="hljs-string" style="color: rgb(152, 195, 121);">&lt;stdio.h&gt;</span></span>

<span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 假设有一个函数读取图片并返回RGB数据</span>
<span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">unsigned</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">char</span>* <span class="hljs-title" style="color: rgb(97, 174, 238);">load_image</span><span class="hljs-params">(<span class="hljs-type" style="color: rgb(209, 154, 102);">const</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">char</span>* image_path, <span class="hljs-type" style="color: rgb(209, 154, 102);">int</span>&amp; width, <span class="hljs-type" style="color: rgb(209, 154, 102);">int</span>&amp; height)</span></span>;

<span class="hljs-function"><span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> <span class="hljs-title" style="color: rgb(97, 174, 238);">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 创建Net对象</span>
    ncnn::Net net;

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 配置选项</span>
    ncnn::Option opt;
    opt.lightmode = <span class="hljs-literal" style="color: rgb(86, 182, 194);">true</span>;
    opt.num_threads = <span class="hljs-number" style="color: rgb(209, 154, 102);">4</span>;
    opt.use_int8_inference = <span class="hljs-literal" style="color: rgb(86, 182, 194);">true</span>;
    net.opt = opt;

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 加载网络结构和模型</span>
    <span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> (net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">load_param</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"mobilenet_v1.param"</span>) != <span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>) {
        <span class="hljs-built_in" style="color: rgb(230, 192, 123);">printf</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"加载参数文件失败\n"</span>);
        <span class="hljs-keyword" style="color: rgb(198, 120, 221);">return</span> <span class="hljs-number" style="color: rgb(209, 154, 102);">-1</span>;
    }
    <span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> (net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">load_model</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"mobilenet_v1.bin"</span>) != <span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>) {
        <span class="hljs-built_in" style="color: rgb(230, 192, 123);">printf</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"加载模型文件失败\n"</span>);
        <span class="hljs-keyword" style="color: rgb(198, 120, 221);">return</span> <span class="hljs-number" style="color: rgb(209, 154, 102);">-1</span>;
    }

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 创建Extractor</span>
    ncnn::Extractor ex = net.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">create_extractor</span>();

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 加载并预处理图片</span>
    <span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> width, height;
    <span class="hljs-type" style="color: rgb(209, 154, 102);">unsigned</span> <span class="hljs-type" style="color: rgb(209, 154, 102);">char</span>* image_data = <span class="hljs-built_in" style="color: rgb(230, 192, 123);">load_image</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"test.jpg"</span>, width, height);
    <span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> (!image_data) {
        <span class="hljs-built_in" style="color: rgb(230, 192, 123);">printf</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"无法加载图片\n"</span>);
        <span class="hljs-keyword" style="color: rgb(198, 120, 221);">return</span> <span class="hljs-number" style="color: rgb(209, 154, 102);">-1</span>;
    }

    ncnn::Mat in = ncnn::Mat::<span class="hljs-built_in" style="color: rgb(230, 192, 123);">from_pixels_resize</span>(image_data, ncnn::Mat::PIXEL_RGB, width, height, <span class="hljs-number" style="color: rgb(209, 154, 102);">224</span>, <span class="hljs-number" style="color: rgb(209, 154, 102);">224</span>);
    in.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">substract_mean_normalize</span>(
        ncnn::<span class="hljs-built_in" style="color: rgb(230, 192, 123);">Mat</span>(<span class="hljs-number" style="color: rgb(209, 154, 102);">3</span>, <span class="hljs-number" style="color: rgb(209, 154, 102);">1</span>, (<span class="hljs-type" style="color: rgb(209, 154, 102);">float</span>[]) {<span class="hljs-number" style="color: rgb(209, 154, 102);">104.f</span>, <span class="hljs-number" style="color: rgb(209, 154, 102);">117.f</span>, <span class="hljs-number" style="color: rgb(209, 154, 102);">123.f</span>}), <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 均值</span>
        ncnn::<span class="hljs-built_in" style="color: rgb(230, 192, 123);">Mat</span>(<span class="hljs-number" style="color: rgb(209, 154, 102);">3</span>, <span class="hljs-number" style="color: rgb(209, 154, 102);">1</span>, (<span class="hljs-type" style="color: rgb(209, 154, 102);">float</span>[]) {<span class="hljs-number" style="color: rgb(209, 154, 102);">1.f</span>, <span class="hljs-number" style="color: rgb(209, 154, 102);">1.f</span>, <span class="hljs-number" style="color: rgb(209, 154, 102);">1.f</span>})      <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 归一化</span>
    );

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 设置输入</span>
    ex.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">input</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"data"</span>, in);

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 提取输出</span>
    ncnn::Mat out;
    ex.<span class="hljs-built_in" style="color: rgb(230, 192, 123);">extract</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"prob"</span>, out);

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 找到概率最高的分类</span>
    <span class="hljs-type" style="color: rgb(209, 154, 102);">float</span> max_score = out[<span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>];
    <span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> max_index = <span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>;
    <span class="hljs-keyword" style="color: rgb(198, 120, 221);">for</span> (<span class="hljs-type" style="color: rgb(209, 154, 102);">int</span> i = <span class="hljs-number" style="color: rgb(209, 154, 102);">1</span>; i &lt; out.w; i++) {
        <span class="hljs-keyword" style="color: rgb(198, 120, 221);">if</span> (out[i] &gt; max_score) {
            max_score = out[i];
            max_index = i;
        }
    }

    <span class="hljs-built_in" style="color: rgb(230, 192, 123);">printf</span>(<span class="hljs-string" style="color: rgb(152, 195, 121);">"预测结果: 类别索引 = %d, 置信度 = %f\n"</span>, max_index, max_score);

    <span class="hljs-comment" style="color: rgb(92, 99, 112); font-style: italic;">// 释放图片数据</span>
    <span class="hljs-built_in" style="color: rgb(230, 192, 123);">free</span>(image_data);

    <span class="hljs-keyword" style="color: rgb(198, 120, 221);">return</span> <span class="hljs-number" style="color: rgb(209, 154, 102);">0</span>;
}</span><span rn-wrapper="" aria-hidden="true" style="counter-reset: linenumber 0; font-size: 14px; left: 0px; letter-spacing: -1px; pointer-events: none; position: absolute; top: 1em; user-select: none; width: 3em;"><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span><span style="counter-increment: linenumber 1; display: block; pointer-events: none;"></span></span></code></pre></details>

### 12. 总结

`ncnn::Net`类作为ncnn框架的核心组件，具备以下显著特点：

1. **灵活的选项配置** ：通过`Option`类，开发者可以细粒度地配置推理参数，如线程数、内存分配策略、优化选项等。
2. **高效的内存管理**：支持自定义内存分配器、内存池复用和自动对齐，确保内存的高效利用和访问效率。
3. **扩展性强**：允许开发者注册自定义层，扩展框架功能，以适应特定的应用需求。
4. **支持多种数据加载方式**：支持从文件系统和内存中加载网络结构和权重，适用于不同的应用场景。
5. **Vulkan加速支持**：通过Vulkan实现GPU加速，提升推理性能，特别适用于移动设备和嵌入式系统。
6. **简便的输入输出管理**：通过Blob索引和名称管理输入和输出，提供多种设置和提取接口，便于集成和使用。
7. **易于使用的接口**：提供简洁的API接口，结合丰富的示例代码，降低了神经网络部署的门槛。

通过本文的详细介绍，相信您已经对`ncnn::Net`类有了全面的了解。无论是在资源受限的移动设备上进行高效推理，还是在嵌入式系统中实现复杂的神经网络应用，`ncnn::Net`类都能为您提供强大的支持和高效的性能表现。

------

希望这篇博客能帮助您更好地理解和使用`ncnn::Net`类，在您的深度学习项目中发挥更大的作用。如果您有任何问题或建议，欢迎在评论区留言讨论！